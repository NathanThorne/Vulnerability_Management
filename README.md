# Azure Vulnerability Management using Greenbone OpenVAS

## Description

This project is a demonstration for using OpenVAS by creating a Vulnerability Management Lab on Azure. I will be creating a OpenVAS configured VM and a client VM. To simulate vulnerability detection of OpenVAS tool, I will scan Client after it creation on default settings than intentionally make it vulnerable by installing multiple outdated application which are very common then do another scan and try to fix the vulnerabilities shown on OpenVAS by updating system and removing outdated applications. I will do another final scan to show you how many vulnerabilities gets fixed.

## Requirement
Prepare Vulnerability Management Scanner
Create Client Virtual Machine and Make it Vulnerable
Perform Unauthenticated Scan
Make Configurations for Authenticated Scans (VM)
Make Configurations for Authenticated Scans (OpenVAS)
Perform Authenticated Scan against our Vulnerable Windows VM
Remediate Vulnerabilities
Verify Remediation

## Requirement

- No special requirement just internet and browser to access Azure Portal.

### Environment Used

- Azure VM
- OpenVAS on Azure
- Microsoft Windows 11


## Links

- OpenVAS - https://openvas.org/
- Azure Portal - https://portal.azure.com/

### Things to know before
The goal of the lab is to configure and explore the platform, not to practice remediation. I will perform some minor vulnerability remediation, but only to test how the scans change in response.


# Program Walkthrough
Prepare Vulnerability Management Scanner
From the Azure Portal → Go to the Marketplace → “OpenVAS secured and supported by HOSSTED” and proceeded to create a "Vulnerability-Management" resource group and VM.



<p align="center">
Selecting OpenVAS from the Azure Marketplace: <br/>
<img src="https://i.imgur.com/elqUSuC.png"/>
<br />
<br />
<br />
Creating the OpenVAS VM in Azure:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/creating-openvas-vm.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<br />
OpenVAS VM Overview: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/openvas-vm-overview.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
After the VM was created, I used the PuTTy to SSH into the server and allowed the initial configuration to complete.
<br />
<br />
OpenVAS connection via PuTTy:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/openvas-putty.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<h2>Create a Vulnerable Client</h2>
<p align="center">  
Back in the Azure Portal → Virtual Machines → Create In the same resource group and the same VNet as OpenVAS.
<br />
<br />
Vulnerable client VM in Azure<br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/win10-vulnerable-overview.png"
  height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
After the VM was created, I RDP'd into the machine to make it vulnerable by disabling the firewall and installing the following very old versions of software (with known vulnerabilities):
   <br /><b>-FireFox: Firefox Setup 97.0b5</b>
   <br />
  <b>-VLC Player: vlc-1.1.7-win32</b>
   <br />
   <b>-Adobe Reader: 10.0_AdbeRdr1000_en_US_1_ </b> 
  <br />

Disabled Firewall in Windows 10 VM: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/disable-firewall.png"/>
<br />
<br />
Installing insecure software on Windows 10 VM:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/install-insecure2.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<h2>Configure OpenVAS to Perform Unauthenticated Scant</h2>
<p align="center">  
Login to OpenVAS with the URL and credentials provided during initial config → Assets → Hosts → New Host
<br />
<br />
Login to OpenVAS: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/greenbone-signin.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Private IP of client VM:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/win10-vul-privateIP.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<br />
 Created a new host by adding client VM private IP Address <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/adding-new-host.png"/>
<br />
<br />
Host in Greenbone:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/greenbone-hosts.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
  Created a New Target from the Host, name it “Azure Vulnerable VM”.
<br />
<br />
Creating a new target: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/greenbone-new-target.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
Created a new Task - “Scan - Azure Vulnerable VMs”
<br />
<br />
New Task:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/greenbone-new-task.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
  Initiated the first scan of the Windows 10 VM client
<br />
<br />
Scan Completed: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/uncred-scan-done.png"
  height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<br />  
<h2>Scan Results</h2>
<h3>Note:</h3>
Since this scan is not credentialed, the results are not an in-depth scan.
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/uncred-scan-result.png"/>
<br />
<br />
Port scan results:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/uncred-scan-ports.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Found CVEs: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/uncred-scan-cve.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Found Closed CVEs:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/uncred-scan-closed-cve.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />

TLS scan results: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/uncred-scan-tls.png"/>
<br />
<br />
<h2>Make Configurations for Credentialed Scans (Within VM)</h2>
Making some changes to the Windows 10 client to allow OpenVAS to perform a more in-depth authenticated/credentialed scan.

Disabled User Account Control
Disable UAC:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/disable-uac.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
To allow OpenVAS to authenticate, I made the following registry changes:
<br /><b>-Enabled Remote Registry (services.msc)</b>
<br />
<b>-Launching Registry Editor (regedit.exe - as Admin)</b>
<br />
<b>-Navigated to: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System </b> 
<br />
<b>-Navigated to: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System </b> 
<b>-Set the registry key by creating a new DWORD (32-bit) value with the following properties: 
  Name: LocalAccountTokenFilterPolicy  Value: 1 </b> 

<br />
<br />
<p align="center">
Enable Remote Registry: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/enable-remote-registry.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Creating new DWORD:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/new-dword.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Setting the Registry Key):  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/set-registry-key.png"
  height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
Make Configurations for Credentialed Scans (OpenVAS)
Created a new credential under, Configuration → Credentials → New Credential → Added username & password for Windows 10 VM client under "Azure VM Credentials"
<br />
<br />
<br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/config-creds.png"/>
<br />
<br />
Created a new target, and attached the new credentials
<br />
Add credentials to new target:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/add-creds-to-target.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<h2>Execute Credentialed Scan against our Vulnerable Windows VM</h2>

In OpenVAS, Scans → Tasks

To create the credentialed scan, I cloned the “Scan - Azure Vulnerable VMs” Task, then changed it to update the scan name and target.
<br />
<br />
<center>Creating credentialed scan:</center> <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/clone-task.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Initialized the credentialed scan and reviewed the results.
<br />
<b>Credentialed Scan Results</b>
Now we can see the insecure software installed earlier, flagged for remediation in the scan results.
</b>

<Creating credentialed scan:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/cred-scan-results.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
The SMB results show that OpenVAS was able to authenticate successfully.
<br />

Successful SMB authentication: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/cred-scan-smb.png"/>
<br />
<br />
Credentialed scan - ports results:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/cred-scan-ports.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Credentialed scan - CVEs: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/cred-scan-cve.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Credentialed scan - closed CVE results:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/cred-scan-closed-cve.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />Credentialed scan - applications results:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/cred-scan-apps.png"
  height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<h2>Remediate Vulnerabilities</h2>
On the Win10-Vulnerable VM, I removed Adobe Reader, VLC Player, and Firefox. Originally, I planned to update these applications, but some versions were too outdated. It seemed more straightforward to uninstall them instead of downloading new versions and reinstalling everything, especially since we don't require these specific applications.

<br/>
Additionally, I attempted to activate the firewall, but it negatively impacted OpenVAS' scanning capability. Worried that reverting the UAC might have a similar effect, I opted to modify the Network Security Group (NSG). Specifically, I changed it from allowing all inbound RDP connections to permitting connections solely from my IP address. In the Win10-Vulnerable VM, I ensured that all available updates were applied.
<br/>
<br/>

Windows 10 VM client NSG before: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/win10-vul-nsg-before.png"/>
<br />
<br />
Windows 10 VM client NSG after:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/win10-vul-nsg-after.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Completed Windows Update: <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/windows-update-done.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<h2>Verify Remediation</h2>
Re-initiated the “Credentialed Scan - Azure Vulnerable VMs ” task and observed the results.
<br />
Post Remediation Results page:  <br/>
<img src="https://fieldnotes.iruldanet.com/assets/images/openvas-test/post-remediation-cred-scan.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<h2>Reflection</h2>

Analyzing how we manage vulnerabilities in Azure with Greenbone OpenVAS is interesting. While fixing critical issues seems effective, it's curious that applying system updates didn't change the scan much. I'm wondering if the timing of scans matters – maybe waiting some time after updates could make a difference?

I'm keen on setting up a local version of this lab and adding Nessus and Qualys scanners for comparison. Seeing how different scanners report vulnerabilities could give us a better understanding. The plan is to check if these scanners find issues that others might miss.

Sharing the process and findings while setting up the lab could help others, and it's a good way to contribute to the cybersecurity community.

</p>
